# Configuración de física de Geant4 para simulación de radioterapia
# Optimizado para haces de fotones de 6 MV

# ==================================================
# Physics List Principal
# ==================================================
physics_list:
  name: "QGSP_BIC_EMZ"  # Recomendado para aplicaciones médicas
  # Alternativas:
  # - "emstandard_opt3": Más rápido, buena precisión
  # - "emstandard_opt4": Mayor precisión, más lento
  # - "emlivermore": Baja energía, alta precisión
  # - "empenelope": Baja energía, transporte detallado

# ==================================================
# Cortes de Producción (Production Cuts)
# ==================================================
# Definen el rango mínimo bajo el cual las partículas secundarias
# no se siguen y su energía se deposita localmente
production_cuts:
  # Cortes en el World (fuera del volumen de interés)
  world:
    gamma: 1.0  # mm
    electron: 1.0  # mm
    positron: 1.0  # mm
    proton: 1.0  # mm
  
  # Cortes en el Phantom (volumen de interés dosimétrico)
  phantom:
    gamma: 0.1  # mm - Mayor precisión en región de interés
    electron: 0.1  # mm
    positron: 0.1  # mm
    proton: 1.0  # mm
  
  # Cortes en componentes del Linac
  linac_components:
    gamma: 0.5  # mm - Intermedio
    electron: 0.5  # mm
    positron: 0.5  # mm
    proton: 1.0  # mm

# ==================================================
# Límites de Paso (Step Limits)
# ==================================================
# Garantizan que las interacciones se calculen con suficiente resolución
step_limits:
  world:
    max_step_mm: 10.0  # Pasos grandes fuera del volumen de interés
  
  phantom:
    max_step_mm: 0.5  # Pasos pequeños para precisión dosimétrica
  
  linac_head:
    max_step_mm: 1.0  # Intermedio para componentes del acelerador

# ==================================================
# Procesos Electromagnéticos Específicos
# ==================================================
em_processes:
  # Ionización
  ionization:
    enabled: true
    fluctuations: true  # Fluctuaciones de Landau/Vavilov
  
  # Bremsstrahlung
  bremsstrahlung:
    enabled: true
    lpm_effect: true  # Efecto Landau-Pomeranchuk-Migdal (alta energía)
  
  # Dispersión múltiple de Coulomb
  multiple_scattering:
    enabled: true
    model: "WentzelVI"  # Modelo preciso para altas energías
    # Alternativas: "Urban", "GoudsmitSaunderson"
  
  # Efecto fotoeléctrico
  photoelectric:
    enabled: true
    model: "standard"  # o "livermore" para baja energía
  
  # Dispersión Compton
  compton_scattering:
    enabled: true
    model: "Klein-Nishina"
  
  # Producción de pares
  pair_production:
    enabled: true
    model: "standard"
  
  # Dispersión Rayleigh (opcional, relevante en baja energía)
  rayleigh_scattering:
    enabled: false  # Usualmente desactivado en 6 MV

# ==================================================
# Procesos Hadránicos (Protones)
# ==================================================
hadronic_processes:
  enabled: false  # No relevante para fotones de 6 MV
  # Activar solo si se simulan neutrones o protones

# ==================================================
# Opciones de Tracking
# ==================================================
tracking:
  # Umbral de energía mínima de seguimiento
  tracking_cut:
    gamma_keV: 1.0  # No seguir fotones por debajo de 1 keV
    electron_keV: 1.0
    positron_keV: 1.0
  
  # Opciones de precisión
  linear_loss_limit: 0.01  # Pérdida de energía fraccional por paso
  
  # Seguridad en fronteras
  safety_margin_mm: 0.01

# ==================================================
# Configuración de Regiones Especiales
# ==================================================
regions:
  # Región del phantom (alta precisión)
  phantom_region:
    name: "PhantomRegion"
    apply_cuts: true
    production_threshold_mm: 0.1
  
  # Región del acelerador (precisión estándar)
  linac_region:
    name: "LinacRegion"
    apply_cuts: true
    production_threshold_mm: 0.5
  
  # Región del mundo (baja precisión)
  world_region:
    name: "WorldRegion"
    apply_cuts: true
    production_threshold_mm: 1.0

# ==================================================
# Opciones de Optimización
# ==================================================
optimization:
  # Usar navegación regular para geometría voxelizada
  regular_navigation:
    enabled: true
    skip_equal_materials: true  # Acelera el tracking en materiales homogéneos
  
  # Caché de materiales
  material_cache:
    enabled: true
    density_tolerance_gcm3: 0.01  # Agrupar voxels con densidad similar
  
  # Transporte de partículas en paralelo
  multi_threading:
    enabled: true
    number_of_threads: 0  # 0 = usar todos los cores disponibles

# ==================================================
# Visualización y Debug
# ==================================================
visualization:
  # Opciones para visualizar trayectorias
  track_visualization:
    enabled: false  # Desactivar en producción
    gamma_color: [0, 1, 0]  # Verde
    electron_color: [1, 0, 0]  # Rojo
    positron_color: [0, 0, 1]  # Azul
    max_tracks: 100  # Número máximo de trayectorias a visualizar

# ==================================================
# Validación de Física
# ==================================================
validation:
  # Verificar consistencia de la configuración
  check_overlaps: true  # Detectar superposiciones de geometría
  verbose_level: 1  # 0=silencioso, 1=normal, 2=detallado, 3=debug
  
  # Reportes de física
  physics_tables: false  # Imprimir tablas de procesos físicos
  cross_sections: false  # Imprimir secciones eficaces

# ==================================================
# Notas Técnicas
# ==================================================
notes: |
  Configuración de física optimizada para simulación de radioterapia con GATE 10:
  
  1. QGSP_BIC_EMZ: Combina física hadrónica (no usada aquí) con electromagnética
     estándar de alta calidad (EMZ = EM Zelda, similar a opt4).
  
  2. Cortes de producción:
     - World: 1 mm (reduce tiempo de cómputo en regiones no críticas)
     - Phantom: 0.1 mm (mayor precisión en cálculo de dosis)
     - Los cortes se expresan en rango (distancia recorrida), no en energía
  
  3. Navegación regular optimizada:
     - ComputeStepSkippingEqualMaterials acelera hasta 3x en medios homogéneos
     - DensityTolerance agrupa materiales similares para reducir overhead
  
  4. Validación recomendada:
     - Comparar PDDs con mediciones experimentales
     - Verificar perfiles laterales y penumbras
     - Validar factores de campo (output factors)
  
  Referencias:
  - Geant4 Physics Reference Manual v11.3
  - AAPM TG-268: Monte Carlo dose calculation for radiotherapy
